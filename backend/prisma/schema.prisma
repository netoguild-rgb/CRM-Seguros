generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SystemConfig {
  id              Int     @id @default(autoincrement())
  storageType     String  @default("LOCAL")
  googleDriveJson Json?   
  googleFolderId  String? 
  smtpHost        String?
  smtpPort        Int?
  smtpUser        String?
  smtpPass        String?
  smtpSecure      Boolean @default(true)
}

// --- DOCUMENTOS ---
model Document {
  id        Int      @id @default(autoincrement())
  nome      String
  categoria String   
  url       String   
  tipo      String   // 'LOCAL' ou 'DRIVE'
  path      String?  
  
  clientId  Int
  client    Client   @relation(fields: [clientId], references: [id])
  
  // Novo: Vínculo com Sinistro (Opcional)
  claimId   Int?
  claim     Claim?   @relation(fields: [claimId], references: [id])

  criadoEm  DateTime @default(now())
}

// --- CLIENTES ---
model Client {
  id               Int      @id @default(autoincrement())
  nome             String
  tipo             String   @default("PF")
  cpf_cnpj         String?  @unique
  whatsapp         String?
  email            String?
  cidade           String?
  estado           String?
  
  // Veículo
  renavam            String?
  modelo_veiculo     String?
  ano_veiculo        String?
  condutor_principal String?
  km                 String?

  // Coberturas
  guincho            String?
  carro_reserva      String?
  danos_terceiros    String? 

  apolices         Policy[]
  documentos       Document[]
  claims           Claim[]    // Cliente tem vários sinistros
  criadoEm         DateTime @default(now())
}

// --- APÓLICES ---
model Policy {
  id             Int      @id @default(autoincrement())
  numero         String?
  status         String   @default("ATIVA")
  tipo_seguro    String
  data_inicio    DateTime
  data_fim       DateTime
  premio_liquido Float?
  comissao       Float?
  pdf_url        String?  
  pdf_file_id    String?  
  clientId       Int
  client         Client   @relation(fields: [clientId], references: [id])
  claims         Claim[]  // Apólice pode ter sinistros
}

// --- SINISTROS (NOVO MÓDULO) ---
model Claim {
  id             Int      @id @default(autoincrement())
  
  // Dados Básicos
  status         String   @default("ABERTO") // ABERTO, ANALISE, VISTORIA, REPARO, CONCLUIDO, NEGADO
  data_ocorrencia DateTime
  data_aviso     DateTime @default(now())
  tipo_sinistro  String   // Colisão, Roubo, Incêndio, Terceiros
  descricao      String?

  // Oficina & Terceiros
  oficina_nome   String?
  oficina_tel    String?
  terceiro_nome  String?
  terceiro_tel   String?
  placa_terceiro String?

  // Valores
  valor_franquia Float?
  valor_orcamento Float?
  valor_final    Float?

  // Relacionamentos
  clientId       Int
  client         Client   @relation(fields: [clientId], references: [id])
  policyId       Int?
  policy         Policy?  @relation(fields: [policyId], references: [id])
  
  documentos     Document[] // Fotos, BO, Orçamentos

  atualizadoEm   DateTime @updatedAt
}

// --- LEADS ---
model Lead {
  id              Int      @id @default(autoincrement())
  criadoEm        DateTime @default(now())
  nome            String
  whatsapp        String
  email           String?
  cpf             String?
  status          String   @default("NOVO")
  tipo_seguro     String?
  placa           String?
  modelo_veiculo  String?
  ano_veiculo     String?
  uso_veiculo     String?
  dados_extras    Json?
}