generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- CONFIGURAÇÃO ---
model SystemConfig {
  id              Int     @id @default(autoincrement())
  storageType     String  @default("LOCAL")
  localPath       String? 
  googleDriveJson Json?   
  googleFolderId  String? 
  smtpHost        String?
  smtpPort        Int?
  smtpUser        String?
  smtpPass        String?
  smtpSecure      Boolean @default(true)
}

// --- USUÁRIOS ---
model User {
  id           Int           @id @default(autoincrement())
  nome         String
  email        String        @unique
  senha        String   
  perfil       String        @default("PRODUTOR")
  comissao     Float         @default(10)
  apolices     Policy[]
  appointments Appointment[]
  criadoEm     DateTime      @default(now())
}

// --- CLIENTES (ATUALIZADO COM NOVOS CAMPOS) ---
model Client {
  id               Int      @id @default(autoincrement())
  nome             String
  tipo             String   @default("PF")
  cpf_cnpj         String?  @unique
  whatsapp         String?
  email            String?
  cidade           String?
  estado           String?
  
  // AUTO
  renavam            String?
  placa              String? // Novo
  modelo_veiculo     String?
  ano_veiculo        String?
  uso_veiculo        String? // Novo
  condutor_principal String?
  idade_condutor     String? // Novo
  km                 String?
  
  // AUTO - Coberturas
  guincho            String? // km_guincho
  carro_reserva      String?
  danos_terceiros    String? // cobertura_terceiros
  cobertura_roubo    String? // Novo

  // VIDA (Novos)
  capital_vida       String?
  profissao          String?
  motivo_vida        String?

  // SAÚDE (Novos)
  preferencia_rede   String?
  idades_saude       String?
  plano_saude        String?

  // GERAL
  obs_final          String?  // Anotações vindas do bot
  preferences        Json?    
  questionnaires     Json?    

  apolices         Policy[]
  documentos       Document[]
  claims           Claim[]
  appointments     Appointment[]
  criadoEm         DateTime @default(now())
}

// --- LEADS (INTEGRAÇÃO TYPEBOT) ---
model Lead {
  id              Int      @id @default(autoincrement())
  criadoEm        DateTime @default(now())
  
  // Status do Funil
  status          String   @default("NOVO") // NOVO, CONTATADO, COTACAO, VENDA, PERDIDO
  
  // Dados de Contato
  nome            String
  whatsapp        String
  tipo_seguro     String?  // Auto, Vida, Saude
  
  // Variáveis Específicas do Typebot
  obs_final          String?
  capital_vida       String?
  profissao          String?
  motivo_vida        String?
  preferencia_rede   String?
  idades_saude       String?
  plano_saude        String?
  cobertura_roubo    String?
  cobertura_terceiros String?
  carro_reserva      String?
  km_guincho         String?
  renavan            String?
  placa              String?
  ano_do_veiculo     String? // Mapeado para ano_veiculo no Client
  modelo_veiculo     String?
  uso_veiculo        String?
  idade_do_condutor  String? // Mapeado para idade_condutor no Client
  condutor_principal String?
  
  dados_extras    Json? // Para guardar qualquer outra coisa que sobrar
}

// --- AGENDA ---
model Appointment {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  date        DateTime
  type        String   
  status      String   @default("PENDENTE")
  clientId    Int?
  client      Client?  @relation(fields: [clientId], references: [id])
  userId      Int?
  user        User?    @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())
}

// --- FINANCEIRO ---
model FinancialRecord {
  id          Int      @id @default(autoincrement())
  type        String   
  category    String   
  description String
  amount      Float
  dueDate     DateTime 
  status      String   @default("PENDENTE")
  paidAt      DateTime? 
  createdAt   DateTime @default(now())
}

// --- APÓLICES, DOCUMENTOS, SINISTROS (MANTIDOS) ---
model Policy {
  id             Int      @id @default(autoincrement())
  numero         String?
  status         String   @default("ATIVA")
  tipo_seguro    String
  data_inicio    DateTime
  data_fim       DateTime
  premio_liquido Float?
  comissao_total Float?
  userId         Int?     
  user           User?    @relation(fields: [userId], references: [id])
  pdf_url        String?  
  pdf_file_id    String?  
  clientId       Int
  client         Client   @relation(fields: [clientId], references: [id])
  claims         Claim[]
}

model Document {
  id        Int      @id @default(autoincrement())
  nome      String
  categoria String   
  url       String   
  tipo      String   
  path      String?  
  clientId  Int
  client    Client   @relation(fields: [clientId], references: [id])
  claimId   Int?
  claim     Claim?   @relation(fields: [claimId], references: [id])
  criadoEm  DateTime @default(now())
}

model Claim {
  id             Int      @id @default(autoincrement())
  status         String   @default("ABERTO")
  data_ocorrencia DateTime
  data_aviso     DateTime @default(now())
  tipo_sinistro  String
  descricao      String?
  oficina_nome   String?
  oficina_tel    String?
  terceiro_nome  String?
  terceiro_tel   String?
  placa_terceiro String?
  valor_franquia Float?
  valor_orcamento Float?
  valor_final    Float?
  clientId       Int
  client         Client   @relation(fields: [clientId], references: [id])
  policyId       Int?
  policy         Policy?  @relation(fields: [policyId], references: [id])
  documentos     Document[]
  atualizadoEm   DateTime @updatedAt
}